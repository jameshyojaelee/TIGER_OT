================================================================================
WORKFLOW UPDATES - 2025-10-04
================================================================================

HIGHLIGHTS:
- Added required `--species {mouse,human}` flag to `scripts/04_run_workflow.sh` / `run_tiger.py`
- Auto-wire species-specific Ensembl names and transcriptomes via `configs/default.yaml`
- `scripts/01_setup_workspace.sh` now bootstraps the human transcriptome from `/gpfs/commons/home/jameslee/reference_genome`
- Ensembl downloads are case-insensitive (input gene symbols can be upper/lower/mixed)

DETAILS:
- `configs/default.yaml` and `configs/smoke-test.yaml` now expose `species_options` with Ensembl IDs + reference paths
- `run_tiger.py` enforces the species choice, logs the resolved Ensembl name, and injects the matching transcriptome path
- `workflows/master.py` tracks original vs resolved gene symbols so downstream steps stay consistent
- `scripts/02_quick_check.sh` / `scripts/03_preflight_check.sh` validate both mouse and human transcriptomes
- `scripts/01_setup_workspace.sh` copies `gencode.v47.transcripts.fa` on demand (decompressing from the central gzipped archive)
- Documentation refreshed to cover the new CLI and reference expectations

NOTES:
- Large reference FASTA files remain git-ignored; copying happens locally during setup
- Smoke-test config maps both species to the bundled miniature reference so quick runs stay lightweight

================================================================================
WORKFLOW UPDATES - 2025-09-30
================================================================================

Two new features integrated from invivo_pilot/naive_ot:

1. MM0 TOLERANCE PARAMETER
2. MM0 LOCATION VALIDATION

================================================================================

1. MM0 TOLERANCE PARAMETER
================================================================================

WHAT IT DOES:
- Provides flexible MM0 filtering instead of strict minimum
- Allows guides with MM0 in range: [min_MM0, min_MM0 + tolerance]

CONFIGURATION (configs/default.yaml):
  filtering:
    mm0_tolerance: 3  # Default
    
OPTIONS:
- 0:   Strictest (only minimum MM0 per gene)
- 1-5: Moderate flexibility (recommended: 3)
- 999: Ignore MM0 entirely (only use MM1=0, MM2=0)

BENEFITS:
- More guides per gene (more options)
- Balances specificity with guide availability
- Useful when minimum MM0 is high due to gene duplications

EXAMPLE OUTPUT:
  Nanog: MM0 range 1-4 (15 at min, 45 in range)
  Sox2:  MM0 range 2-5 (8 at min, 28 in range)

================================================================================

2. MM0 LOCATION VALIDATION
================================================================================

WHAT IT DOES:
- Analyzes where MM0 perfect matches are located
- Determines if matches are in same gene (OK) vs different genes (concerning)
- Provides detailed report of potential cross-gene off-targets

CONFIGURATION (configs/default.yaml):
  output:
    validate_mm0_locations: true  # Enable validation
    
OUTPUT FILE:
  runs/latest/mm0_location_analysis.csv

REPORT INCLUDES:
- Per-guide breakdown of MM0 match locations
- Summary statistics (same gene vs different genes)
- List of most concerning guides (matches in other genes)
- Transcript isoform details for each guide

EXAMPLE SUMMARY:
  Total guides analyzed: 110
  Matches only in SAME gene (different isoforms): 95 (86.4%)
  Matches in DIFFERENT genes (potential off-targets): 15 (13.6%)

MOST CONCERNING GUIDES:
  Gene       Score   MM0   Other Transcripts          Hits
  Pnpla2     0.952   4     Gene1-201, Gene2-203      2
  Sox2       0.943   3     Gene3-201                 1

================================================================================

OTHER UPDATES
================================================================================

UPDATED PARAMETERS:
- min_guide_score: 0.70 → 0.80 (higher quality threshold)

FILES MODIFIED:
- configs/default.yaml              - Added mm0_tolerance, validate_mm0_locations
- workflows/master.py      - Updated _apply_adaptive_mm0(), added _step_validate_mm0()
- src/lib/tiger/validation.py  - Added validation script (NEW)
- docs/WORKFLOW_GUIDE.md        - Updated documentation

FILES CREATED:
- src/lib/tiger/validation.py  - MM0 location analysis script
- docs/UPDATE_SUMMARY.txt       - This summary (NEW)

================================================================================

QUICK START
================================================================================

Run workflow as usual:

  cd /gpfs/commons/groups/sanjana_lab/Cas13/TIGER
  scripts/04_run_workflow.sh targets.txt

Check results:
  
  # Main guides
  head runs/latest/final_guides.csv
  
  # MM0 location analysis (if enabled)
  head runs/latest/mm0_location_analysis.csv

Adjust settings in configs/default.yaml:

  # For stricter filtering
  mm0_tolerance: 0
  min_guide_score: 0.85
  
  # For more flexibility
  mm0_tolerance: 5
  min_guide_score: 0.70
  
  # Disable MM0 validation (faster)
  validate_mm0_locations: false

================================================================================

DOCUMENTATION
================================================================================

See docs/WORKFLOW_GUIDE.md for complete documentation:
- Configuration section
- MM0 Tolerance Parameter
- MM0 Location Validation (Optional)
- Validation & Troubleshooting

================================================================================

Status: ✅ Ready to use
Date: 2025-09-30

================================================================================
